<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-code Tool Path Simulator</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2" />
                    <path d="M16 6 L16 26 M6 16 L26 16" stroke="currentColor" stroke-width="1.5" />
                    <circle cx="16" cy="16" r="3" fill="currentColor" />
                </svg>
                <h1>G-code Simulator</h1>
            </div>
            <div class="controls-header">
                <span class="status-indicator" id="statusIndicator">Ready</span>
            </div>
        </header>

        <main class="main-content">
            <!-- Left Panel - G-code Input -->
            <aside class="panel gcode-panel">
                <div class="panel-header">
                    <h2>G-code Input</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" id="loadFileBtn" title="Load G-code file">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="17,8 12,3 7,8" />
                                <line x1="12" y1="3" x2="12" y2="15" />
                            </svg>
                            Load
                        </button>
                        <button class="btn btn-success" id="saveFileBtn" title="Save G-code file">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="7,10 12,15 17,10" />
                                <line x1="12" y1="15" x2="12" y2="3" />
                            </svg>
                            Save
                        </button>
                        <button class="btn btn-primary" id="loadDxfBtn" title="Import DXF file and convert to G-code"
                            style="background: linear-gradient(135deg, #7b61ff, #00d4ff);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14,2 14,8 20,8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                            </svg>
                            DXF→G-code
                        </button>
                    </div>
                </div>
                <div class="filename-bar">
                    <label for="filenameInput">Filename:</label>
                    <input type="text" id="filenameInput" value="my_gcode.gcode" placeholder="Enter filename...">
                </div>
                <!-- Interactive G-code Editor with Line Comments -->
                <div class="gcode-editor" id="gcodeEditor">
                    <div class="editor-lines" id="editorLines">
                        <!-- Lines will be populated by JS -->
                    </div>
                </div>
                <textarea id="gcodeInput" style="display:none;"></textarea>
                <!-- Line Edit Modal -->
                <div class="line-edit-modal" id="lineEditModal" style="display:none;">
                    <div class="modal-header">
                        <span>Edit Line <span id="editLineNum">1</span></span>
                        <button class="modal-close" id="modalClose">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="original-line" id="originalLine"></div>
                        <input type="text" id="lineEditInput"
                            placeholder="e.g., 'move to 100,50' or 'speed 600' or 'delete'">
                        <div class="modal-actions">
                            <button class="btn btn-primary" id="applyLineEdit">Apply AI Edit</button>
                            <button class="btn btn-secondary" id="cancelLineEdit">Cancel</button>
                        </div>
                    </div>
                </div>
                <input type="file" id="fileInput" accept=".gcode,.nc,.ngc,.txt" hidden>
                <input type="file" id="dxfFileInput" accept=".dxf" hidden>
            </aside>

            <!-- Center - Canvas Visualization -->
            <section class="canvas-section">
                <div class="canvas-controls">
                    <div class="control-group">
                        <button class="btn btn-primary" id="simulateBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5,3 19,12 5,21" />
                            </svg>
                            Simulate
                        </button>
                        <button class="btn btn-secondary" id="pauseBtn" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="6" y="4" width="4" height="16" />
                                <rect x="14" y="4" width="4" height="16" />
                            </svg>
                            Pause
                        </button>
                        <button class="btn btn-secondary" id="resetBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                <path d="M3 3v5h5" />
                            </svg>
                            Reset
                        </button>
                    </div>
                    <div class="control-group">
                        <label for="speedSlider">Speed:</label>
                        <input type="range" id="speedSlider" min="1" max="100" value="50">
                        <span id="speedValue">50%</span>
                    </div>
                </div>

                <div class="canvas-wrapper">
                    <canvas id="simulatorCanvas"></canvas>
                    <div class="canvas-overlay" id="canvasOverlay">
                        <div class="grid-info">
                            <span id="cursorPos">X: 0.00 Y: 0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                    <span class="progress-text" id="progressText">0%</span>
                </div>
            </section>

            <!-- Right Panel - Info -->
            <aside class="panel info-panel">
                <div class="panel-header">
                    <h2>Simulation Info</h2>
                </div>
                <div class="info-content">
                    <div class="info-section">
                        <h3>Tool Position</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>X</label>
                                <span id="toolX">0.000</span>
                                <small>mm</small>
                            </div>
                            <div class="info-item">
                                <label>Y</label>
                                <span id="toolY">0.000</span>
                                <small>mm</small>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>Statistics</h3>
                        <div class="stats-list">
                            <div class="stat-item">
                                <span class="stat-label">Total Lines</span>
                                <span class="stat-value" id="statLines">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">G0 (Rapid)</span>
                                <span class="stat-value" id="statG0">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">G1 (Linear)</span>
                                <span class="stat-value" id="statG1">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Current Line</span>
                                <span class="stat-value" id="statCurrentLine">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Feed Rate</span>
                                <span class="stat-value" id="statFeedRate">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>Bounding Box</h3>
                        <div class="bbox-info">
                            <div class="bbox-item">
                                <span>X Range:</span>
                                <span id="bboxX">0 - 0</span>
                            </div>
                            <div class="bbox-item">
                                <span>Y Range:</span>
                                <span id="bboxY">0 - 0</span>
                            </div>
                            <div class="bbox-item">
                                <span>Width:</span>
                                <span id="bboxWidth">0 mm</span>
                            </div>
                            <div class="bbox-item">
                                <span>Height:</span>
                                <span id="bboxHeight">0 mm</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>Legend</h3>
                        <div class="legend">
                            <div class="legend-item">
                                <span class="legend-color rapid"></span>
                                <span>G0 Rapid Move</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color linear"></span>
                                <span>G1 Linear Cut</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color tool"></span>
                                <span>Tool Position</span>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- AI Chat Panel -->
    <div class="chat-panel" id="chatPanel">
        <div class="chat-header" id="chatHeader">
            <div class="chat-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <span>AI G-code Assistant</span>
            </div>
            <button class="chat-toggle" id="chatToggle">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18,15 12,9 6,15" />
                </svg>
            </button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message assistant">
                    <div class="message-content">
                        Hello! I'm your G-code assistant. I can help you:
                        <ul>
                            <li>Modify your G-code</li>
                            <li>Add shapes (circles, rectangles)</li>
                            <li>Adjust feed rates and positions</li>
                            <li>Explain G-code commands</li>
                        </ul>
                        Ask me anything!
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Ask about G-code or request modifications..." />
                <button class="btn btn-primary" id="chatSendBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13" />
                        <polygon points="22,2 15,22 11,13 2,9" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="simulator.js"></script>
</body>

</html>